import json

import demistomock as demisto  # noqa: F401
from CommonServerPython import *  # noqa: F401

data = demisto.args()['json'] if 'json' in demisto.args() else False
titleKey = demisto.args()['titleKey'] if 'titleKey' in demisto.args() else "Report"
title = demisto.args()['title'] if 'title' in demisto.args() else None

excludeKeys = demisto.args()['excludeKeys'].split(",") if 'excludeKeys' in demisto.args() else []

if "." in titleKey:
    l = titleKey.split(".")
    titleKey = data[l[0]]

    if len(l) > 1:
        l.pop(0)
        for i in l:
            titleKey = titleKey[i]

elif title:
    titleKey = title

md = f"# {titleKey}\n\n"

for k, v in data.items():
    if k in excludeKeys:
        continue
    if isinstance(v, list):
        md += f"**{k}** "
        md += "\n".join(v)
    elif isinstance(v, dict):
        md += "\n"
        md += f"**{k}**\n"
        md += json.dumps(v).replace("\",", "\n").replace("{", "").replace("}", "").replace("\\n",
                                                                                           "\n").replace("[", "\n").replace("]", "\n").replace(", \"", "\n").replace("\"", "")
        md += "\n"
    else:
        md += f"**{k}** "
        md += f"{str(v)}\n"

entry = {
    'Type': 1,
    'Contents': md,
    'ContentsFormat': 'markdown',
    'HumanReadable': md,
    'ReadableContentsFormat': 'markdown'
}


demisto.results(entry)
