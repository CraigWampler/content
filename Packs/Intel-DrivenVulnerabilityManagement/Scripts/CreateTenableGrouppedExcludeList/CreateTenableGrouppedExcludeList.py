import demistomock as demisto  # noqa: F401
from CommonServerPython import *  # noqa: F401

open_vuln = demisto.executeCommand(
    "getIncidents", {'query': 'type:TenableVulnerability and -status:Closed'})[0]['Contents']['data']
# demisto.results(str(open_vuln))
excludeList = {}

if open_vuln:
    for vuln in open_vuln:

        if 'opentenableids' in vuln['CustomFields']:
            opentenIDs = vuln['CustomFields']['opentenableids'].split(',')
            host = vuln['CustomFields']['tenablehost']

            excludeList[host] = opentenIDs

    md = tableToMarkdown('Open Tenable IDs Already Reported', excludeList)
    return_outputs(md, {'ExcludeList': excludeList})
else:
    return_outputs('No Results', {'ExcludeList': excludeList})
