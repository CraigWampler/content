import demistomock as demisto  # noqa: F401
from CommonServerPython import *  # noqa: F401

#listName = demisto.args()['listName']
dArgs = demisto.args()
csvList = dArgs['csvList']
csv = csvList.split('\n')
#csv = demisto.executeCommand("getList", {"listName":listName})
contextKey = dArgs['contextKey'] if 'contextKey' in dArgs else 'CSVList'
#csv = csv[0]['Contents'].split('\n')

mapping = []

headerList = dArgs['headerList'] if 'headerList' in dArgs else False

HEADERS = dArgs['headers'] if 'headers' in dArgs else True
#HEADERS = demisto.args()['headers']

if headerList:
    headers = headerList.split(',')
elif HEADERS:
    headers = csv.pop(0).split(',')
else:
    headers = range(len(csv))

for entry in csv:
    values = entry.split(',')
    tmp = {}
    for index, value in enumerate(values):
        if value:
            tmp[headers[index].replace(' ', '_')] = value
    mapping.append(tmp)

md = tableToMarkdown(contextKey, mapping)


entry = {
    'Type': entryTypes['note'],
    'Contents': mapping,
    'ContentsFormat': formats['json'],
    'HumanReadable': md,
    'ReadableContentsFormat': formats['markdown'],
    'EntryContext': {contextKey: mapping}
}

demisto.results(entry)
