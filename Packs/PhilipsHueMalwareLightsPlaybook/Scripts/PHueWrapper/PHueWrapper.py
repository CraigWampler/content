import random

import demistomock as demisto  # noqa: F401
from CommonServerPython import *  # noqa: F401
from phue import Bridge

b = Bridge()

lights = b.get_light_objects()

for light in lights:
    light.brightness = 254
    light.xy = [random.random(), random.random()]


def rgb_to_xy(red, green, blue):

    red = pow((red + 0.055) / (1.0 + 0.055), 2.4) if red > 0.04045 else (red / 12.92)
    green = pow((green + 0.055) / (1.0 + 0.055), 2.4) if green > 0.04045 else (green / 12.92)
    blue = pow((blue + 0.055) / (1.0 + 0.055), 2.4) if blue > 0.04045 else (blue / 12.92)

    # convert rgb to xyz
    x = red * 0.649926 + green * 0.103455 + blue * 0.197109
    y = red * 0.234327 + green * 0.743075 + blue * 0.022598
    z = green * 0.053077 + blue * 1.035763

    x = x / (x + y + z)
    y = y / (x + y + z)

    return [x, y]


b = Bridge()  # bridge IP here.

# If running for the first time, press button on bridge and run with b.connect() uncommented
# b.connect() only for the first time

xy = rgb_to_xy(1.0, 0.28627, 0.95686)

lights = b.get_light_objects()

for light in lights:
    # y might be used as brightness value, however, dark colors will turn the lights off
    #brightness = int(xy[1]*255)
    brightness = 255
    light.xy = xy
